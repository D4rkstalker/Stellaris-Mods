namespace = utopia
# The Whisperers in the Void
country_event = {
	id = utopia.3304
	title = "utopia.3000.name"
	desc = "utopia.3304.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}
	
	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}
	
	option = {
		name = "utopia.3304.a"
		custom_tooltip = "covenant.tooltip"
		add_modifier = { modifier = covenant_whisperers_in_the_void days = -1 }
		hidden_effect = {
			set_country_flag = has_shroud_patron
			set_country_flag = whispers_in_the_void
			country_event = { id = utopia.3310 } # Covenant Sealed
		}
	}
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# The Composer of Strands
country_event = {
	id = utopia.3305
	title = "utopia.3000.name"
	desc = "utopia.3305.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}
	
	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}
	
	option = {
		name = "utopia.3305.a"
		custom_tooltip = "covenant.tooltip"
		add_modifier = { modifier = covenant_composer_of_strands days = -1 }
		hidden_effect = {
			set_country_flag = has_shroud_patron
			set_country_flag = composer_of_strands
			country_event = { id = utopia.3310 } # Covenant Sealed
		}
	}
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}


# The Eater of Worlds
country_event = {
	id = utopia.3306
	title = "utopia.3000.name"
	desc = "utopia.3306.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}
	
	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}
	
	option = {
		name = "utopia.3306.a"
		custom_tooltip = "covenant.tooltip"
		add_modifier = { modifier = covenant_eater_of_worlds days = -1 }
		hidden_effect = {
			set_country_flag = has_shroud_patron
			set_country_flag = eater_of_worlds
			country_event = { id = utopia.3310 } # Covenant Sealed
			random_owned_planet = {
				limit = { 
					is_capital = no 
					any_owned_pop = {
						is_sapient = yes
						is_robot_pop = no					
					}				
				}
				random_owned_pop = {
					limit = {
						is_sapient = yes
						is_robot_pop = no
					}
					kill_pop = yes
				}
			}
		}
	}
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# The Instrument of Desire
country_event = {
	id = utopia.3307
	title = "utopia.3000.name"
	desc = "utopia.3307.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}
	
	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}
	
	option = {
		name = "utopia.3307.a"
		custom_tooltip = "covenant.tooltip"
		add_modifier = { modifier = covenant_instrument_of_desire days = -1 }
		hidden_effect = {
			set_country_flag = has_shroud_patron
			set_country_flag = instrument_of_desire
			country_event = { id = utopia.3310 } # Covenant Sealed
		}
	}
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# The End of the Cycle
country_event = {
	id = utopia.3308
	title = "utopia.3000.name"
	desc = "utopia.3308.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}
	
	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}
	
	option = {
		name = "utopia.3308.a"	
		custom_tooltip = "covenant.cycle.tooltip"
		add_modifier = { modifier = covenant_end_of_the_cycle days = 18000 } # You really shouldn't have done that...
		hidden_effect = {
			set_global_flag = end_of_the_cycle
			set_country_flag = has_shroud_patron
			set_country_flag = covenant_end_of_the_cycle
			every_owned_planet = {
				limit = { NOT = { has_modifier = covenant_shroud_marked } }
				add_modifier = { modifier = covenant_shroud_marked days = -1 }
			}
			every_subject = {
				every_owned_planet = {
					limit = { NOT = { has_modifier = covenant_shroud_marked } }
					add_modifier = { modifier = covenant_shroud_marked days = -1 }
				}			
			}
			country_event = { id = utopia.3310 } # Covenant Sealed
			country_event = { id = utopia.3320 days = 18000 }
		}
	}
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}
